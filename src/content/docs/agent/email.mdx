# Email Analysis Agent

The Email Analysis Agent is a specialized AI agent designed to analyze incoming emails, determine if they require commercial responses, and provide insights and recommendations for appropriate actions.

## Overview

The agent processes emails through several stages:
1. Content and metadata analysis
2. Sentiment analysis
3. Commercial opportunity detection
4. Lead qualification
5. Response suggestion generation

## Capabilities

### Email Analysis
- Extracts and analyzes email content and metadata
- Identifies key topics and themes
- Determines message intent and urgency

### Sentiment Analysis
- Analyzes tone and sentiment of email content
- Detects emotional context
- Identifies potential customer satisfaction/dissatisfaction

### Commercial Opportunity Detection
- Identifies potential business opportunities
- Categorizes commercial intent
- Assesses potential value
- Recommends follow-up actions

### Lead Qualification
- Evaluates sender information
- Assesses lead quality
- Determines lead stage in sales funnel
- Suggests qualification actions

### Response Suggestions
- Generates appropriate response recommendations
- Provides response templates
- Suggests response priority and timing

## Command Structure

The agent uses a standardized command structure for email analysis:

```json
{
  "task": "analyze_emails",
  "description": "Analyze incoming emails to determine if they require a commercial response",
  "targets": [
    {
      "analysis": {
        "summary": "",
        "insights": [],
        "sentiment": "",
        "priority": "",
        "action_items": [],
        "response_suggestions": [],
        "commercial_opportunity": {
          "requires_response": false,
          "response_type": null,
          "priority_level": null,
          "suggested_actions": [],
          "potential_value": null,
          "next_steps": []
        }
      }
    }
  ],
  "tools": [
    {
      "name": "email_analysis",
      "description": "analyze email content and metadata",
      "status": "not_initialized",
      "type": "synchronous"
    },
    {
      "name": "sentiment_analysis",
      "description": "analyze sentiment and tone of email content",
      "status": "not_initialized",
      "type": "synchronous"
    },
    {
      "name": "commercial_opportunity_detection",
      "description": "detect potential commercial opportunities in email content",
      "status": "not_initialized",
      "type": "synchronous"
    },
    {
      "name": "lead_qualification",
      "description": "qualify potential leads based on email content",
      "status": "not_initialized",
      "type": "synchronous"
    },
    {
      "name": "response_suggestion",
      "description": "generate appropriate response suggestions",
      "status": "not_initialized",
      "type": "synchronous"
    }
  ]
}
```

## Usage

### API Endpoint

```http
POST /api/agents/email
```

### Request Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `agentId` | string | Yes | ID of the agent to handle the analysis |
| `site_id` | string | Yes | ID of the site associated with these emails |
| `limit` | number | No | Maximum number of emails to fetch (default: 10) |
| `lead_id` | string | No | Optional lead ID to associate with the analysis |
| `team_member_id` | string | No | Optional team member ID to associate with the analysis |
| `analysis_type` | string | No | Type of analysis to perform (default: comprehensive) |

### Response Structure

Success Response:
```json
{
  "success": true,
  "data": {
    "commandId": "cmd_xyz789",
    "status": "processing",
    "message": "Command created successfully",
    "emailCount": 15
  }
}
```

Error Response:
```json
{
  "success": false,
  "error": {
    "code": "EMAIL_CONFIG_NOT_FOUND",
    "message": "Email configuration not found for site"
  }
}
```

## Integration

The Email Analysis Agent can be integrated with:
- CRM systems for lead management
- Email marketing platforms
- Customer support systems
- Sales automation tools

## Best Practices

1. **Email Configuration**
   - Ensure proper email credentials are stored securely
   - Configure appropriate IMAP/SMTP settings
   - Set up email filters if needed

2. **Analysis Settings**
   - Define clear analysis objectives
   - Set appropriate email fetch limits
   - Specify relevant analysis types

3. **Response Handling**
   - Monitor command status for completion
   - Process analysis results promptly
   - Implement appropriate follow-up actions

4. **Security**
   - Use secure email connections
   - Handle credentials securely
   - Respect email privacy guidelines

## Error Handling

Common error codes and their meanings:

| Code | Description |
|------|-------------|
| `INVALID_REQUEST` | Invalid request parameters |
| `UNAUTHORIZED` | Unauthorized access |
| `NOT_FOUND` | Resource not found |
| `EMAIL_CONFIG_NOT_FOUND` | Email configuration not found |
| `EMAIL_CREDENTIALS_ERROR` | Error with email credentials |
| `SMTP_CONNECTION_ERROR` | Error connecting to email server |
| `SYSTEM_ERROR` | Internal system error |

## Examples

### Basic Analysis Request

```javascript
const response = await fetch('/api/agents/email', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    agentId: 'agent_email_analyzer_123',
    site_id: 'site_abc123',
    limit: 15,
    analysis_type: 'commercial_opportunity'
  })
});

const result = await response.json();
```

### With Lead Association

```javascript
const response = await fetch('/api/agents/email', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    agentId: 'agent_email_analyzer_123',
    site_id: 'site_abc123',
    limit: 10,
    lead_id: 'lead_xyz789',
    analysis_type: 'lead_qualification'
  })
});

const result = await response.json();
``` 