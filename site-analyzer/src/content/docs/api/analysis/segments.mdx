---
title: API de An치lisis de Segmentos Rentables
description: Documentaci칩n completa para la API de an치lisis y creaci칩n de segmentos rentables para sitios web
---

# API de An치lisis de Segmentos Rentables

El endpoint `/api/site/segments` permite analizar un sitio web para identificar los segmentos de audiencia m치s rentables, evaluando patrones de comportamiento, demograf칤a y oportunidades de monetizaci칩n. Adem치s, puede crear autom치ticamente estos segmentos en la base de datos del usuario si no existen.

> 游 **Potencia tu estrategia de segmentaci칩n** 
> 
> Esta API utiliza modelos avanzados de IA para identificar segmentos de audiencia altamente rentables, 
> analizar su comportamiento y proponer estrategias de monetizaci칩n espec칤ficas para cada uno.
> Integra perfectamente con plataformas publicitarias como Google Ads, Facebook Ads, TikTok Ads y LinkedIn Ads.

## Caracter칤sticas principales

- An치lisis conversacional con respuestas en formato JSON estructurado
- Identificaci칩n de los N segmentos m치s rentables para un sitio web
- Creaci칩n autom치tica de segmentos en la base de datos del usuario
- An치lisis basado en m칰ltiples fuentes de datos (comportamiento, demograf칤a, intereses)
- Soporte para diferentes modelos de IA para el an치lisis
- Personalizaci칩n de criterios de rentabilidad y relevancia
- Captura y an치lisis de capturas de pantalla del sitio web

import { UnifiedApiTester } from '@/components/ApiTester';

<UnifiedApiTester 
  apiType="segments" 
  title="Analizador de Segmentos Rentables"
  description="Prueba el API de an치lisis de segmentos rentables con tus propios par치metros."
  defaultEndpoint="/api/site/segments"
  defaultMethod="POST"
  defaultUrl="https://ejemplo.com"
  defaultSegmentCount={5}
  defaultTimeout="45000"
  showModelOptions={true}
  defaultModelType="openai"
  defaultModel="gpt-4o"
  showSiteUrlField={true}
  additionalFields={[
    {
      name: "url",
      label: "URL del sitio a analizar",
      type: "text",
      defaultValue: "https://ejemplo.com",
      placeholder: "https://tusitio.com",
      required: true
    },
    {
      name: "mode",
      label: "Modo de operaci칩n",
      type: "select",
      options: [
        { value: "analyze", label: "An치lisis (sin crear segmentos)" },
        { value: "create", label: "Creaci칩n (crear segmentos nuevos)" },
        { value: "update", label: "Actualizaci칩n (actualizar segmentos existentes)" }
      ],
      defaultValue: "analyze"
    },
    {
      name: "segmentCount",
      label: "N칰mero de segmentos a crear",
      type: "number",
      defaultValue: 5,
      min: 1,
      max: 20
    },
    {
      name: "includeScreenshot",
      label: "Incluir captura de pantalla",
      type: "checkbox",
      defaultValue: true
    },
    {
      name: "profitabilityMetrics",
      label: "M칠tricas de rentabilidad",
      type: "multiselect",
      options: [
        { value: "conversionRate", label: "Tasa de conversi칩n" },
        { value: "aov", label: "Valor promedio de pedido" },
        { value: "ltv", label: "Valor de vida del cliente" },
        { value: "engagementRate", label: "Tasa de engagement" },
        { value: "adRevenue", label: "Ingresos por publicidad" }
      ],
      defaultValue: ["conversionRate", "ltv"]
    },
    {
      name: "additionalInstructions",
      label: "Indicaciones adicionales",
      type: "textarea",
      placeholder: "Proporciona cualquier informaci칩n adicional o instrucciones espec칤ficas para el an치lisis...",
      rows: 4
    },
    {
      name: "aiProvider",
      label: "Proveedor de IA para an치lisis",
      type: "select",
      options: [
        { value: "openai", label: "OpenAI" },
        { value: "anthropic", label: "Anthropic" },
        { value: "gemini", label: "Google (Gemini)" }
      ],
      defaultValue: "openai"
    },
    {
      name: "aiModel",
      label: "Modelo de IA para an치lisis",
      type: "select",
      options: [
        { value: "gpt-4o", label: "GPT-4o" },
        { value: "gpt-4-turbo", label: "GPT-4 Turbo" },
        { value: "claude-3-5-sonnet-20240620", label: "Claude 3.5 Sonnet" },
        { value: "claude-3-opus-20240229", label: "Claude 3 Opus" },
        { value: "gemini-1.5-pro", label: "Gemini 1.5 Pro" }
      ],
      defaultValue: "gpt-4o"
    }
  ]}
/>

## Funcionamiento interno

> 游댃 **Integraci칩n con API de Conversaci칩n**
> 
> Esta API utiliza internamente la API de Conversaci칩n para analizar el sitio web.
> Esto permite aprovechar todas las capacidades de los modelos de IA multimodales,
> incluyendo el an치lisis de capturas de pantalla y contenido HTML del sitio.
> Cuando se proporciona una URL, siempre se realiza un an치lisis real del sitio.

El flujo de procesamiento de la API es el siguiente:

1. **Recepci칩n de par치metros**: La API recibe la URL del sitio y los par치metros de configuraci칩n
2. **Captura de datos**: Se obtiene el HTML y opcionalmente una captura de pantalla del sitio
3. **An치lisis con IA**: Se utiliza la API de Conversaci칩n para analizar los datos con el modelo seleccionado
4. **Procesamiento de resultados**: Se estructuran los segmentos identificados
5. **Operaciones en base de datos**: Seg칰n el modo seleccionado, se crean o actualizan segmentos
6. **Respuesta estructurada**: Se devuelve un JSON con los segmentos y metadatos del an치lisis

## Modos de operaci칩n

> 游눠 **Selecciona el modo adecuado para tu caso de uso**
> 
> La API ofrece tres modos de operaci칩n que determinan c칩mo se procesan los segmentos identificados.
> Elige el que mejor se adapte a tus necesidades de integraci칩n y flujo de trabajo.

| Modo | Par치metro | Descripci칩n | Caso de uso t칤pico |
|------|-----------|-------------|-------------------|
| **An치lisis** | `mode: "analyze"` | Analiza el sitio web y devuelve los segmentos m치s rentables identificados, sin crearlos en la base de datos. | Cuando solo necesitas informaci칩n sobre segmentos potenciales sin almacenarlos. |
| **Creaci칩n** | `mode: "create"` | Analiza el sitio web, identifica los segmentos m치s rentables y los crea autom치ticamente en la base de datos del usuario si no existen. | Para iniciar una estrategia de segmentaci칩n desde cero. |
| **Actualizaci칩n** | `mode: "update"` | Analiza el sitio web, identifica los segmentos m치s rentables y actualiza los existentes en la base de datos con nueva informaci칩n. | Para mantener tus segmentos actualizados con los 칰ltimos datos. |

## M칠todos disponibles

### POST /api/site/segments

Analiza un sitio web para identificar los segmentos m치s rentables y opcionalmente los crea en la base de datos seg칰n el modo de operaci칩n seleccionado.

#### Par치metros de solicitud

```json
{
  "url": "https://ejemplo.com", // URL del sitio (obligatorio)
  "segmentCount": 5, // N칰mero de segmentos a identificar (1-20)
  "mode": "create", // Modo de operaci칩n: 'analyze', 'create', 'update'
  "segmentCount": 10, // N칰mero de segmentos a crear en la DB (1-20, por defecto 10)
  "includeScreenshot": true, // Incluir captura de pantalla en el an치lisis
  "timeout": 45000, // Tiempo m치ximo de espera en milisegundos
  "profitabilityMetrics": ["conversionRate", "ltv", "aov"], // M칠tricas para evaluar rentabilidad
  "minConfidenceScore": 0.7, // Puntuaci칩n m칤nima de confianza (0-1)
  "includeRationale": true, // Incluir explicaci칩n para cada segmento
  "segmentAttributes": ["demographic", "behavioral", "psychographic"], // Atributos a considerar
  "industryContext": "ecommerce", // Contexto de industria para el an치lisis
  "additionalInstructions": "Enfocarse en segmentos con alto potencial de compra recurrente y analizar patrones de navegaci칩n en dispositivos m칩viles.", // Indicaciones adicionales en formato texto
  "aiProvider": "openai", // Proveedor de IA: 'openai', 'anthropic', 'gemini'
  "aiModel": "gpt-4o" // Modelo espec칤fico de IA a utilizar
}
```

> 游닇 **Nota sobre el formato de respuesta**
> 
> Esta API siempre devuelve respuestas en formato JSON estructurado, optimizado para su procesamiento autom치tico.
> No es necesario especificar un formato de respuesta, ya que el sistema est치 configurado para generar
> respuestas JSON consistentes con la estructura documentada.

#### Respuesta

```json
{
  "url": "https://ejemplo.com",
  "segmentsAnalyzed": 5,
  "segmentsCreated": 3, // N칰mero de segmentos nuevos creados (si mode=create)
  "segmentsUpdated": 0, // N칰mero de segmentos actualizados (si mode=update)
  "segments": [
    {
      "id": "seg_content_creators",
      "name": "Creadores de Contenido Digital",
      "description": "Profesionales y aficionados de 20-40 a침os dedicados a la creaci칩n de contenido digital para redes sociales y plataformas online",
      "summary": "Segmento altamente rentable de creadores digitales con necesidades espec칤ficas de herramientas profesionales y disposici칩n a invertir en soluciones que mejoren su flujo de trabajo creativo.",
      "estimatedSize": "15%",
      "profitabilityScore": 0.88,
      "confidenceScore": 0.93,
      "targetAudience": "media_entertainment",
      "audienceProfile": {
        "adPlatforms": {
          "googleAds": {
            "demographics": {
              "ageRanges": ["25-34", "35-44"],
              "gender": ["male", "female"],
              "parentalStatus": ["parent"],
              "householdIncome": ["top 10%", "top 20%"]
            },
            "interests": [
              "Digital Content Creation",
              "Video Production",
              "Photography",
              "Graphic Design",
              "Technology Early Adopters"
            ],
            "inMarketSegments": [
              "Software",
              "Creative Software",
              "Video Editing Software",
              "Photography Equipment",
              "Computer Hardware"
            ]
          },
          "facebookAds": {
            "demographics": {
              "age": [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
              "education": ["College grad", "In grad school", "Master's degree"],
              "generation": ["Millennials", "Gen Z"]
            },
            "interests": [
              "Adobe Creative Cloud",
              "Content creation",
              "Digital marketing",
              "Video production",
              "Photography"
            ]
          }
        },
        "crossPlatformAudience": {
          "deviceUsage": {
            "primaryDevices": ["High-end laptops", "Professional desktops"],
            "secondaryDevices": ["Premium smartphones", "Tablets"],
            "operatingSystems": ["macOS", "Windows 10/11"]
          },
          "purchasingBehavior": {
            "researchPhase": "Extensive research before purchase",
            "priceConsideration": "Value-focused but willing to pay premium for quality"
          }
        }
      },
      "language": "es",
      "attributes": {
        "demographic": {
          "ageRange": "20-40",
          "gender": "mixto",
          "income": "medio-alto",
          "education": "superior",
          "location": "principalmente urbana",
          "occupation": "creadores digitales, freelancers, influencers"
        },
        "behavioral": {
          "deviceUsage": ["laptop (70%)", "smartphone (25%)", "tablet (5%)"],
          "softwarePreference": ["Adobe Creative Suite", "DaVinci Resolve", "Canva Pro"],
          "purchaseFrequency": "trimestral",
          "averageOrderValue": "$150-300"
        }
      },
      "monetizationOpportunities": [
        {
          "type": "suscripci칩n premium escalonada",
          "potentialRevenue": "alto",
          "implementationDifficulty": "media",
          "description": "Modelo de suscripci칩n con niveles seg칰n necesidades (b치sico, profesional, estudio)",
          "estimatedConversionRate": "18-22%"
        },
        {
          "type": "marketplace de recursos",
          "potentialRevenue": "muy alto",
          "implementationDifficulty": "alta",
          "description": "Plataforma para compra/venta de plantillas, presets y recursos creativos entre usuarios",
          "estimatedConversionRate": "25-30%"
        }
      ],
      "recommendedActions": [
        {
          "action": "Implementar prueba gratuita de 14 d칤as con todas las funcionalidades",
          "priority": "muy alta",
          "expectedImpact": "Aumento del 45% en registros cualificados",
          "timeframe": "1 mes"
        },
        {
          "action": "Crear comunidad de usuarios con foros y tutoriales",
          "priority": "alta",
          "expectedImpact": "Reducci칩n del 30% en cancelaciones",
          "timeframe": "3 meses"
        }
      ],
      "createdInDatabase": true,
      "databaseId": "db_seg_123456",
      "rationale": "Este segmento muestra una disposici칩n excepcional a invertir en herramientas que mejoren su flujo de trabajo creativo y la calidad de su output. Su necesidad constante de actualizaci칩n tecnol칩gica y recursos creativos genera oportunidades recurrentes de monetizaci칩n."
    },
    {
      "id": "seg_luxury_mobile_shoppers",
      "name": "Compradores de lujo en m칩vil",
      "description": "Profesionales urbanos de 30-50 a침os con alto poder adquisitivo que prefieren comprar desde dispositivos m칩viles",
      "summary": "Segmento premium con alto poder adquisitivo que realiza compras exclusivamente desde dispositivos m칩viles, con preferencia por experiencias de compra r치pidas y personalizadas.",
      "estimatedSize": "8%",
      "profitabilityScore": 0.92,
      "confidenceScore": 0.88,
      "targetAudience": "retail",
      "audienceProfile": {
        "adPlatforms": {
          "googleAds": {
            "demographics": {
              "ageRanges": ["35-44", "45-54"],
              "gender": ["male", "female"],
              "parentalStatus": ["parent"],
              "householdIncome": ["top 10%"]
            },
            "interests": [
              "Luxury Goods",
              "High-End Fashion",
              "Luxury Travel",
              "Fine Dining",
              "Luxury Vehicles"
            ]
          }
        },
        "crossPlatformAudience": {
          "deviceUsage": {
            "primaryDevices": ["iPhone Pro/Pro Max", "Samsung Galaxy S/Note series"],
            "secondaryDevices": ["iPad Pro", "High-end laptops"],
            "operatingSystems": ["iOS", "Android"]
          }
        }
      },
      "language": "es-ES",
      "createdInDatabase": true,
      "databaseId": "db_seg_789012",
      "rationale": "Este segmento muestra un valor de orden promedio excepcionalmente alto y una tasa de conversi칩n superior en dispositivos m칩viles. Su comportamiento indica una preferencia clara por experiencias de compra r치pidas y exclusivas desde dispositivos m칩viles."
    },
    {
      "id": "seg_procurement_decision_makers",
      "name": "Responsables de compras corporativas",
      "description": "Gerentes y directores de compras en empresas medianas y grandes con poder de decisi칩n sobre adquisiciones de equipamiento industrial",
      "summary": "Segmento B2B de alto valor compuesto por responsables de decisiones de compra en empresas medianas y grandes, con ciclos de compra largos y alto valor por pedido.",
      "estimatedSize": "12%",
      "profitabilityScore": 0.87,
      "confidenceScore": 0.91,
      "targetAudience": "manufacturing",
      "language": "es-MX",
      "createdInDatabase": false,
      "rationale": "Este segmento representa a los tomadores de decisiones en procesos de compra corporativos con alto valor por transacci칩n y potencial para relaciones comerciales a largo plazo."
    }
  ],
  "siteContext": {
    "industry": "tecnolog칤a",
    "businessModel": "ecommerce",
    "primaryAudience": "profesionales",
    "competitivePosition": "media"
  },
  "analysisMetadata": {
    "timestamp": "2023-06-15T14:30:00Z",
    "aiModel": "gpt-4o",
    "confidenceOverall": 0.85,
    "processingTime": 12345
  },
  "nextSteps": [
    {
      "action": "Configurar campa침as de marketing segmentadas",
      "priority": "alta",
      "resources": ["Gu칤a de configuraci칩n", "Plantillas de campa침as"]
    },
    {
      "action": "Personalizar la experiencia del sitio para cada segmento",
      "priority": "media",
      "resources": ["Herramienta de personalizaci칩n", "Mejores pr치cticas"]
    }
  ],
  "errors": [
    {
      "code": "DATA_LIMITATION",
      "message": "Datos limitados para el an치lisis demogr치fico",
      "affectedSegments": ["seg_prof_tech_enthusiasts"],
      "severity": "baja"
    }
  ]
}
```

### GET /api/site/segments

Obtiene informaci칩n sobre el servicio de an치lisis de segmentos.

#### Respuesta

```json
{
  "service": "AI Segment Analyzer",
  "version": "1.0.0",
  "status": "operational",
  "capabilities": [
    "segment-identification",
    "profitability-analysis",
    "database-integration",
    "multi-model-support"
  ],
  "limits": {
    "maxSegmentsPerRequest": 20,
    "requestsPerDay": 50,
    "maxTimeout": 60000
  },
  "supportedProfitabilityMetrics": [
    "conversionRate",
    "aov",
    "ltv",
    "engagementRate",
    "adRevenue"
  ]
}
```

### GET /api/site/segments/user

Obtiene o genera segmentos para un ID de usuario espec칤fico.
Si se proporciona una URL, genera nuevos segmentos basados en el an치lisis real de esa URL.

#### Par치metros de consulta

| Par치metro | Tipo | Descripci칩n | Requerido | Valor por defecto |
|-----------|------|-------------|-----------|-------------------|
| url | string | URL del sitio a analizar | No | - |
| segmentCount | number | N칰mero de segmentos a crear (1-20) | No | 5 |
| userId | string | ID del usuario para asociar los segmentos | No | system_m2m_user |
| debug | boolean | Si es true, incluye informaci칩n adicional de depuraci칩n | No | false |

> 游닇 **Nota importante sobre el an치lisis**
> 
> Cuando se proporciona una URL, la API siempre realiza un an치lisis real del sitio web.
> El an치lisis incluye la captura del HTML y una captura de pantalla del sitio, y utiliza
> modelos avanzados de IA para identificar los segmentos m치s rentables.
> 
> Si no se proporciona una URL, la API devuelve datos simulados para fines de prueba.

#### Ejemplo de solicitud

```
GET /api/site/segments/user?url=https://ejemplo.com&segmentCount=5&userId=client_123&debug=true
```

#### Respuesta

```json
{
  "userId": "client_123",
  "totalSegments": 5,
  "siteUrl": "https://ejemplo.com",
  "segmentCount": 5,
  "debug": true,
  "processingTime": "12.45 segundos",
  "isDirectApiCall": true,
  "segments": [
    {
      "id": "seg_content_creators",
      "name": "Creadores de Contenido Digital",
      "description": "Profesionales y aficionados de 20-40 a침os dedicados a la creaci칩n de contenido digital para redes sociales y plataformas online",
      "summary": "Segmento altamente rentable de creadores digitales con necesidades espec칤ficas de herramientas profesionales y disposici칩n a invertir en soluciones que mejoren su flujo de trabajo creativo.",
      "estimatedSize": "15%",
      "profitabilityScore": 0.88,
      "confidenceScore": 0.93,
      "targetAudience": "media_entertainment",
      // ... otros campos del segmento
    },
    // ... otros segmentos
  ],
  "siteContext": {
    "industry": "technology",
    "businessModel": "saas",
    "primaryAudience": "professionals",
    "competitivePosition": "leader"
  },
  "nextSteps": [
    {
      "action": "Implementar campa침as espec칤ficas para el segmento de creadores de contenido",
      "priority": "high",
      "resources": ["marketing_team", "content_strategy"]
    }
  ]
}
```

## Integraci칩n con la base de datos

Cuando se utiliza el modo `create` o `update`, la API se integra con la base de datos del usuario para:

1. **Verificar existencia**: Comprueba si ya existen segmentos similares
2. **Crear nuevos segmentos**: Crea registros para segmentos que no existen
3. **Actualizar segmentos**: Actualiza informaci칩n de segmentos existentes
4. **Mantener historial**: Registra cambios en los segmentos a lo largo del tiempo

> 游늵 **Persistencia autom치tica de segmentos**
> 
> La API no solo identifica segmentos rentables, sino que tambi칠n puede crearlos y actualizarlos 
> autom치ticamente en tu base de datos. Esto te permite construir un repositorio de segmentos 
> que evoluciona con el tiempo y se mantiene sincronizado con los cambios en tu sitio web.

El esquema de la base de datos para los segmentos incluye:

```sql
CREATE TABLE segments (
  id VARCHAR(255) PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  attributes JSONB,
  profitability_score FLOAT,
  confidence_score FLOAT,
  estimated_size VARCHAR(50),
  site_url VARCHAR(255),
  monetization_opportunities JSONB,
  recommended_actions JSONB,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

## Ejemplos de uso

> 游눹 **C칩digo listo para usar**
> 
> Los siguientes ejemplos te muestran c칩mo integrar la API de Segmentos Rentables en tu aplicaci칩n.
> Copia, pega y adapta estos fragmentos de c칩digo para comenzar a identificar y monetizar 
> segmentos de audiencia valiosos en cuesti칩n de minutos.

### Analizar segmentos sin crearlos

```javascript
const response = await fetch('https://tudominio.com/api/site/segments', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer tu_token_api'
  },
  body: JSON.stringify({
    url: 'https://ejemplo.com',
    segmentCount: 5,
    mode: 'analyze',
    includeScreenshot: true,
    profitabilityMetrics: ['conversionRate', 'ltv', 'engagementRate'],
    includeRationale: true,
    additionalInstructions: "Enfocarse en segmentos con alto potencial de compra recurrente",
    aiProvider: 'openai',
    aiModel: 'gpt-4o'
  })
});

const data = await response.json();
console.log(data.segments); // Segmentos identificados
console.log(data.siteContext); // Contexto del sitio
```

### Crear segmentos autom치ticamente

```javascript
const response = await fetch('https://tudominio.com/api/site/segments', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer tu_token_api'
  },
  body: JSON.stringify({
    url: 'https://ejemplo.com',
    segmentCount: 8, // Crear solo 8 segmentos en la base de datos
    mode: 'create',
    includeScreenshot: true, // Incluir captura de pantalla para an치lisis visual
    profitabilityMetrics: ['conversionRate', 'aov', 'ltv'],
    segmentAttributes: ['demographic', 'behavioral', 'psychographic'],
    industryContext: 'ecommerce',
    additionalInstructions: "Identificar segmentos con alto potencial de monetizaci칩n a trav칠s de suscripciones y analizar patrones de uso en dispositivos m칩viles.",
    aiProvider: 'anthropic',
    aiModel: 'claude-3-5-sonnet-20240620'
  })
});

const data = await response.json();
console.log(`Segmentos creados: ${data.segmentsCreated}`);
console.log(data.segments.filter(s => s.createdInDatabase)); // Segmentos creados en la DB
```

### Obtener segmentos del usuario

```javascript
const response = await fetch('https://tudominio.com/api/site/segments/user', {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer tu_token_api'
  }
});

const data = await response.json();
console.log(`Total de segmentos: ${data.totalSegments}`);
console.log(data.segments); // Todos los segmentos del usuario
``` 