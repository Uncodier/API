---
title: API de Personalizaci贸n HTML para Segmentos
description: Documentaci贸n para el API de personalizaci贸n de HTML espec铆fica basada en segmentos de audiencia
---

# API de Personalizaci贸n HTML para Segmentos

El endpoint `/api/site/personalize-html` permite generar y aplicar personalizaciones espec铆ficas al HTML de un sitio web basadas en segmentos de audiencia. Esta API es 煤til para adaptar din谩micamente la experiencia de usuario, el contenido y la interfaz de un sitio web seg煤n las caracter铆sticas, preferencias y necesidades de diferentes segmentos de audiencia.

>  **Personalizaci贸n din谩mica del HTML para cada segmento** 
> 
> Esta API analiza las caracter铆sticas espec铆ficas de cada segmento de audiencia y genera modificaciones
> personalizadas al HTML del sitio, adaptando elementos visuales, estructura, contenido y funcionalidades
> para optimizar la experiencia de usuario de ese segmento particular. Ideal para implementar
> estrategias de personalizaci贸n avanzada y marketing dirigido.

## Caracter铆sticas principales

- Personalizaci贸n din谩mica del HTML basada en segmentos espec铆ficos
- Modificaci贸n de elementos visuales, estructura y contenido
- Adaptaci贸n de la navegaci贸n y arquitectura de informaci贸n
- Personalizaci贸n de llamadas a la acci贸n (CTAs) y mensajes clave
- Optimizaci贸n de la experiencia de usuario seg煤n dispositivo
- Implementaci贸n de cambios mediante JavaScript o generaci贸n de HTML est谩tico
- Soporte para A/B testing y experimentaci贸n
- An谩lisis de impacto de las personalizaciones aplicadas

import { UnifiedApiTester } from '@/components/ApiTester';

<UnifiedApiTester 
  apiType="html-personalization" 
  title="Personalizador de HTML por Segmento"
  description="Prueba el API de personalizaci贸n de HTML para segmentos con tus propios par谩metros."
  defaultEndpoint="/api/site/personalize-html"
  defaultMethod="POST"
  showModelOptions={true}
  defaultModelType="anthropic"
  defaultModel="claude-3-5-sonnet-20240620"
/>

## Par谩metros de solicitud

| Par谩metro | Tipo | Descripci贸n | Valores posibles | Requerido |
|-----------|------|-------------|------------------|-----------|
| `url` | string | URL del sitio a personalizar | URL v谩lida | S铆 |
| `segment_id` | string | ID del segmento para el que se personalizar谩 el HTML | Cualquier ID v谩lido | S铆 |
| `personalization_level` | string | Nivel de personalizaci贸n a aplicar | `minimal`, `moderate`, `extensive` | No (default: `moderate`) |
| `target_elements` | array | Tipos de elementos a personalizar | `layout`, `navigation`, `content`, `cta`, `visuals`, `forms`, `all` | No (default: `all`) |
| `implementation_method` | string | M茅todo de implementaci贸n de los cambios | `js_injection`, `static_html`, `hybrid` | No (default: `js_injection`) |
| `user_id` | string | ID del usuario | Cualquier ID v谩lido | No |
| `site_id` | string | ID del sitio | Cualquier ID v谩lido | No |
| `target_pages` | array | URLs espec铆ficas a personalizar (si se omite, se aplica a todo el sitio) | Array de URLs | No |
| `device_type` | string | Tipo de dispositivo para el que personalizar | `all`, `mobile`, `desktop`, `tablet` | No (default: `all`) |
| `aiProvider` | string | Proveedor del modelo de IA | `openai`, `anthropic`, `gemini` | No |
| `aiModel` | string | ID del modelo de IA | Depende del proveedor | No |
| `timeout` | number | Tiempo m谩ximo de espera en ms | 5000-120000 | No (default: 45000) |
| `include_preview` | boolean | Si se debe incluir una vista previa del HTML personalizado | `true`, `false` | No (default: `true`) |
| `include_diff` | boolean | Si se debe incluir un diff de los cambios realizados | `true`, `false` | No (default: `true`) |
| `include_performance_impact` | boolean | Si se debe incluir an谩lisis del impacto en rendimiento | `true`, `false` | No (default: `true`) |
| `includeScreenshot` | boolean | Si se debe incluir una captura de pantalla del resultado | `true`, `false` | No (default: `true`) |
| `test_mode` | boolean | Si se debe ejecutar en modo de prueba sin aplicar cambios | `true`, `false` | No (default: `true`) |

## Ejemplos de uso

### Solicitud b谩sica de personalizaci贸n

```json
{
  "url": "https://ejemplo.com",
  "segment_id": "seg_tech_enthusiasts",
  "personalization_level": "moderate"
}
```

### Personalizaci贸n espec铆fica de elementos

```json
{
  "url": "https://ejemplo.com",
  "segment_id": "seg_senior_citizens",
  "personalization_level": "extensive",
  "target_elements": ["navigation", "forms", "visuals"],
  "device_type": "desktop",
  "implementation_method": "static_html"
}
```

### Personalizaci贸n avanzada con configuraci贸n completa

```json
{
  "url": "https://ejemplo.com",
  "segment_id": "seg_b2b_decision_makers",
  "personalization_level": "extensive",
  "target_elements": ["content", "cta", "layout"],
  "implementation_method": "hybrid",
  "target_pages": [
    "https://ejemplo.com/pricing",
    "https://ejemplo.com/features",
    "https://ejemplo.com/contact"
  ],
  "device_type": "all",
  "aiProvider": "anthropic",
  "aiModel": "claude-3-5-sonnet-20240620",
  "include_preview": true,
  "include_diff": true,
  "include_performance_impact": true,
  "test_mode": false
}
```

## Respuesta

La respuesta incluye los siguientes campos:

| Campo | Tipo | Descripci贸n |
|-------|------|-------------|
| `url` | string | URL del sitio personalizado |
| `segment_id` | string | ID del segmento para el que se personaliz贸 |
| `personalization_id` | string | ID 煤nico de la personalizaci贸n generada |
| `personalizations` | array | Lista de personalizaciones aplicadas |
| `implementation_code` | object | C贸digo de implementaci贸n (JS o HTML) |
| `preview_url` | string | URL de vista previa del sitio personalizado |
| `performance_impact` | object | An谩lisis del impacto en rendimiento |
| `diff_summary` | object | Resumen de los cambios realizados |
| `screenshots` | object | Capturas de pantalla antes/despu茅s |
| `metadata` | object | Metadatos de la solicitud y an谩lisis |

### Ejemplo de respuesta completa

```json
{
  "url": "https://ejemplo.com",
  "segment_id": "seg_tech_enthusiasts",
  "personalization_id": "pers_78901",
  "personalizations": [
    {
      "id": "mod_12345",
      "element_type": "navigation",
      "selector": "nav.main-navigation",
      "modification_type": "restructure",
      "description": "Reorganizaci贸n de la navegaci贸n principal para destacar secciones t茅cnicas y recursos avanzados",
      "rationale": "Los entusiastas de la tecnolog铆a valoran el acceso r谩pido a informaci贸n t茅cnica detallada y recursos avanzados",
      "impact_score": 0.85,
      "before_html": "<nav class=\"main-navigation\">...</nav>",
      "after_html": "<nav class=\"main-navigation\">...</nav>"
    },
    {
      "id": "mod_23456",
      "element_type": "content",
      "selector": ".product-description",
      "modification_type": "enhance",
      "description": "Ampliaci贸n de descripciones de producto con especificaciones t茅cnicas detalladas y comparativas",
      "rationale": "Los entusiastas de la tecnolog铆a toman decisiones basadas en especificaciones t茅cnicas detalladas y comparativas de rendimiento",
      "impact_score": 0.92,
      "before_html": "<div class=\"product-description\">...</div>",
      "after_html": "<div class=\"product-description\">...</div>"
    },
    {
      "id": "mod_34567",
      "element_type": "cta",
      "selector": ".primary-cta",
      "modification_type": "rephrase",
      "description": "Modificaci贸n de CTAs para enfatizar aspectos t茅cnicos y de innovaci贸n",
      "rationale": "Los entusiastas de la tecnolog铆a responden mejor a mensajes que destacan innovaci贸n, rendimiento y especificaciones t茅cnicas",
      "impact_score": 0.78,
      "before_html": "<button class=\"primary-cta\">Comprar ahora</button>",
      "after_html": "<button class=\"primary-cta\">Explorar especificaciones</button>"
    }
  ],
  "implementation_code": {
    "type": "javascript",
    "code": "document.addEventListener('DOMContentLoaded', function() {\n  // C贸digo de personalizaci贸n para el segmento seg_tech_enthusiasts\n  // Modificaci贸n de navegaci贸n\n  const navElement = document.querySelector('nav.main-navigation');\n  if (navElement) {\n    // C贸digo de modificaci贸n...\n  }\n  \n  // Modificaci贸n de descripciones de producto\n  const productDescriptions = document.querySelectorAll('.product-description');\n  if (productDescriptions.length > 0) {\n    // C贸digo de modificaci贸n...\n  }\n  \n  // Modificaci贸n de CTAs\n  const ctaButtons = document.querySelectorAll('.primary-cta');\n  if (ctaButtons.length > 0) {\n    // C贸digo de modificaci贸n...\n  }\n});"
  },
  "preview_url": "https://preview.uncodie.com/personalization/pers_78901",
  "performance_impact": {
    "overall_score": 0.92,
    "metrics": {
      "load_time_impact": "+0.2s",
      "first_contentful_paint_impact": "+0.15s",
      "largest_contentful_paint_impact": "+0.25s",
      "cumulative_layout_shift_impact": "+0.01",
      "total_blocking_time_impact": "+0.1s"
    },
    "recommendations": [
      "Considerar lazy loading para las im谩genes t茅cnicas adicionales",
      "Optimizar el script de personalizaci贸n para reducir el tiempo de bloqueo"
    ]
  },
  "diff_summary": {
    "elements_modified": 12,
    "content_blocks_changed": 8,
    "styles_modified": 15,
    "scripts_added": 1,
    "total_changes": 36,
    "change_complexity": "medium"
  },
  "screenshots": {
    "before": "https://storage.uncodie.com/screenshots/original_12345.png",
    "after": "https://storage.uncodie.com/screenshots/personalized_12345.png"
  },
  "metadata": {
    "request": {
      "timestamp": "2024-07-15T16:42:18Z",
      "parameters": {
        "url": "https://ejemplo.com",
        "segment_id": "seg_tech_enthusiasts",
        "personalization_level": "moderate",
        "implementation_method": "js_injection"
      }
    },
    "analysis": {
      "modelUsed": "claude-3-5-sonnet-20240620",
      "aiProvider": "anthropic",
      "processingTime": "2.35 seconds",
      "segmentDataSource": "seg_tech_enthusiasts (last updated: 2024-07-10)",
      "siteScanDate": "2024-07-15T15:30:22Z",
      "status": "success",
      "personalizationStrategy": "adaptive_content_and_ui",
      "segmentInsights": [
        "Preferencia por informaci贸n t茅cnica detallada",
        "Valoraci贸n de comparativas y benchmarks",
        "Inter茅s en caracter铆sticas avanzadas y personalizables",
        "Preferencia por interfaces densas en informaci贸n"
      ]
    }
  }
}
```

## C贸digos de estado

| C贸digo | Descripci贸n |
|--------|-------------|
| 200 | Solicitud exitosa |
| 400 | Par谩metros inv谩lidos |
| 404 | Segmento o sitio no encontrado |
| 422 | No se pudo generar personalizaci贸n v谩lida |
| 429 | L铆mite de solicitudes excedido |
| 500 | Error interno del servidor |

## Consideraciones de implementaci贸n

### M茅todos de implementaci贸n

La API ofrece tres m茅todos principales para implementar las personalizaciones:

1. **JS Injection**: Genera un script JavaScript que modifica el DOM en tiempo real cuando el usuario visita el sitio. Es la opci贸n m谩s flexible y no requiere modificar el c贸digo fuente del sitio.

2. **Static HTML**: Genera versiones est谩ticas del HTML personalizado que pueden ser servidas directamente a los usuarios del segmento. Ofrece mejor rendimiento pero requiere integraci贸n con el sistema de servicio del sitio.

3. **Hybrid**: Combina ambos enfoques, generando HTML est谩tico para los elementos cr铆ticos y usando JavaScript para personalizaciones din谩micas o basadas en interacci贸n.

### Integraci贸n con sistemas de segmentaci贸n

Esta API est谩 dise帽ada para integrarse con sistemas de segmentaci贸n de usuarios existentes. Puede utilizarse junto con:

- Cookies o localStorage para almacenar informaci贸n de segmento
- Sistemas de gesti贸n de consentimiento (CMP)
- Plataformas de CDP (Customer Data Platform)
- Herramientas de anal铆tica web

### Consideraciones de rendimiento

Las personalizaciones pueden afectar el rendimiento del sitio. Recomendaciones:

- Utilizar el campo `include_performance_impact` para evaluar el impacto antes de implementar
- Considerar el uso de lazy loading para contenido personalizado pesado
- Implementar estrategias de cach茅 para personalizaciones frecuentes
- Monitorear m茅tricas Core Web Vitals despu茅s de implementar personalizaciones

### Pruebas y optimizaci贸n

Se recomienda:

1. Comenzar con `test_mode: true` para evaluar las personalizaciones sin aplicarlas
2. Utilizar `personalization_level: minimal` inicialmente y aumentar gradualmente
3. Implementar A/B testing para medir el impacto real en conversiones
4. Refinar las personalizaciones bas谩ndose en datos de comportamiento del usuario 

### Almacenamiento en Redis

Los datos de los segmentos se almacenan en Redis utilizando sus tipos de datos nativos. Aqu铆 hay un ejemplo de c贸mo se estructuran los datos:

```bash
# Variables
site_id="example_site"
segment_id="seg_tech_enthusiasts"

# Guardar metadatos como Hash
HSET site:${site_id}:segments:${segment_id}:metadata \
  created_at "2024-07-15T16:42:18Z" \
  updated_at "2024-07-15T16:42:18Z" \
  version "1.0"

# Guardar una personalizaci贸n de navegaci贸n como Hash
# El id 煤nico de la modificaci贸n es mod_12345
HSET site:${site_id}:segments:${segment_id}:personalizations:mod_12345 \
  element_type "navigation" \
  selector "nav.main-navigation" \
  modification_type "restructure" \
  description "Reorganizaci贸n de la navegaci贸n principal para destacar secciones t茅cnicas" \
  rationale "Los entusiastas de la tecnolog铆a valoran el acceso r谩pido a informaci贸n t茅cnica" \
  impact_score "0.85" \
  "html:before" "<nav class=\"main-navigation\">...</nav>" \
  "html:after" "<nav class=\"main-navigation\">...</nav>"

# Guardar una personalizaci贸n de contenido como Hash
# El id 煤nico de la modificaci贸n es mod_23456
HSET site:${site_id}:segments:${segment_id}:personalizations:mod_23456 \
  element_type "content" \
  selector ".product-description" \
  modification_type "enhance" \
  description "Ampliaci贸n de descripciones de producto con especificaciones t茅cnicas" \
  rationale "Los entusiastas de la tecnolog铆a toman decisiones basadas en especificaciones t茅cnicas" \
  impact_score "0.92" \
  "html:before" "<div class=\"product-description\">...</div>" \
  "html:after" "<div class=\"product-description\">...</div>"

# Ejemplo m谩s detallado de una personalizaci贸n de contenido
# El id 煤nico de la modificaci贸n es mod_34567
HSET site:${site_id}:segments:${segment_id}:personalizations:mod_34567 \
  element_type "content" \
  selector ".product-features" \
  modification_type "enhance" \
  description "Ampliaci贸n y reorganizaci贸n de caracter铆sticas t茅cnicas del producto" \
  rationale "Los entusiastas de tecnolog铆a priorizan las especificaciones t茅cnicas detalladas" \
  impact_score "0.89" \
  "html:before" "<div class=\"product-features\"><h3>Caracter铆sticas</h3><ul><li>Procesador r谩pido</li><li>Alta resoluci贸n</li><li>Bater铆a duradera</li></ul></div>" \
  "html:after" "<div class=\"product-features\"><h3>Especificaciones T茅cnicas</h3><ul><li>Procesador: Octa-core 2.4GHz, 4nm</li><li>Pantalla: AMOLED 2400x1080px, 120Hz</li><li>Bater铆a: 5000mAh, carga r谩pida 65W</li><li>RAM: 12GB LPDDR5</li><li>Almacenamiento: 256GB UFS 3.1</li><li>GPU: Adreno 740</li></ul></div>" \
  "additional_styles" "font-size: 14px; line-height: 1.5; color: #334455; padding: 12px; background-color: #f8f9fa;" \
  "target_devices" "desktop,tablet" \
  "priority" "high" \
  "conditional_display" "true" \
  "condition_script" "return window.innerWidth > 768 && document.referrer.includes('tech')" \
  "js_enhancement" "document.querySelector('.product-features').addEventListener('click', function() { showDetailedSpecs(123); });"

# Guardar 铆ndices para b煤squeda r谩pida de personalizaciones por tipo de elemento
SADD site:${site_id}:segments:${segment_id}:element_types:navigation mod_12345
SADD site:${site_id}:segments:${segment_id}:element_types:content mod_23456

# Guardar lista de todas las personalizaciones del segmento
SADD site:${site_id}:segments:${segment_id}:all_personalizations mod_12345 mod_23456

# Guardar reglas como Hash
HSET site:${site_id}:segments:${segment_id}:rules \
  device_type "desktop,tablet" \
  user_type "tech_enthusiast" \
  "preferences:content_density" "high" \
  "preferences:technical_level" "advanced"

# Guardar lista de segmentos del sitio como Set
SADD site:${site_id}:segment_list ${segment_id}
```

La estructura en Redis utiliza los siguientes patrones de clave y tipos de datos:

1. **Metadatos**: Hash con clave `site:{site_id}:segments:{segment_id}:metadata`
2. **Personalizaciones individuales**: Hash con clave `site:{site_id}:segments:{segment_id}:personalizations:{modification_id}`
3. **ndices por tipo de elemento**: Set con clave `site:{site_id}:segments:{segment_id}:element_types:{element_type}`
4. **Lista de todas las personalizaciones**: Set con clave `site:{site_id}:segments:{segment_id}:all_personalizations`
5. **Reglas**: Hash con clave `site:{site_id}:segments:{segment_id}:rules`
6. **Lista de segmentos**: Set con clave `site:{site_id}:segment_list`

Para recuperar los datos:

```bash
# Variables
site_id="example_site"
segment_id="seg_tech_enthusiasts"

# Obtener todos los metadatos de un segmento
HGETALL site:${site_id}:segments:${segment_id}:metadata

# Obtener todas las personalizaciones de un segmento
SMEMBERS site:${site_id}:segments:${segment_id}:all_personalizations

# Obtener una personalizaci贸n espec铆fica por su ID
HGETALL site:${site_id}:segments:${segment_id}:personalizations:mod_12345

# Obtener todas las personalizaciones de un tipo espec铆fico de elemento
SMEMBERS site:${site_id}:segments:${segment_id}:element_types:navigation
# Luego obtener cada personalizaci贸n individualmente
HGETALL site:${site_id}:segments:${segment_id}:personalizations:mod_12345

# Obtener reglas
HGETALL site:${site_id}:segments:${segment_id}:rules

# Obtener todos los segmentos de un sitio
SMEMBERS site:${site_id}:segment_list
```

Consideraciones importantes:

1. **Estructura de personalizaciones**: Cada personalizaci贸n tiene:
   - Un ID 煤nico como `mod_12345`
   - Un tipo de elemento (navigation, content, cta, etc.)
   - Un selector CSS para identificar el elemento en el DOM
   - Un tipo de modificaci贸n (restructure, enhance, rephrase, etc.)
   - Contenido HTML antes y despu茅s de la modificaci贸n

2. **TTL (Time To Live)**: Se puede establecer para cada clave seg煤n necesidad
```bash
# Establecer TTL de 24 horas (86400 segundos)
EXPIRE site:${site_id}:segments:${segment_id}:metadata 86400
```

3. **ndices secundarios**: Permiten buscar personalizaciones por tipo de elemento
   - til para obtener todas las personalizaciones de navegaci贸n, CTAs, etc.
   - Mejora la eficiencia de las consultas comunes

4. **Eficiencia**:
   - Los Hash permiten acceder a campos espec铆ficos sin cargar todo el objeto
   - Los Set son eficientes para operaciones de pertenencia y listas 煤nicas